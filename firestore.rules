/**
 * This ruleset enforces a security model for the CineMagic movie catalog application.
 *
 * Core Philosophy:
 * The primary goal is to provide public, read-only access to a catalog of movies.
 * This allows any user, authenticated or not, to browse and view movie details.
 * All write operations (creating, updating, deleting movies) are currently disabled
 * as a secure default, pending schema changes to define content ownership.
 *
 * Data Structure:
 * The data is organized in a single top-level collection:
 * - /movies/{movieId}: Contains all individual movie documents.
 *
 * Key Security Decisions:
 * - Public Read Access: The `/movies` collection is publicly readable to everyone
 *   to facilitate browsing the catalog.
 * - Writes Disabled by Default: All write operations are disallowed (`if false`).
 *   To enable secure writes, the `Movie` data entity must be updated to include
 *   an ownership field (e.g., 'authorId' or 'creatorId'). The rules can then be
 *   updated to grant write access only to the designated owner.
 *
 * Denormalization for Authorization:
 * This ruleset is prepared for a denormalization strategy. Once an ownership field
 * like `authorId` is added directly to each movie document, the rules can be
 * easily updated to perform a fast and cheap ownership check without needing
 * extra database reads.
 *
 * Structural Segregation:
 * Not applicable in this model, as all movie data is considered public.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages the movie catalog. Allows public read access but restricts all
     *              write operations until a proper ownership model is defined in the data schema.
     * @path /movies/{movieId}
     * @allow (get) Anyone, including unauthenticated users, can read a specific movie document.
     * @deny (create) Any user attempting to create a new movie document. The schema is missing an ownership field.
     * @principle Public Read with Secure Writes. Writes are currently disabled pending a schema update
     *            to include an ownership field (e.g., 'authorId').
     */
    match /movies/{movieId} {
      allow get: if true;
      allow list: if true;

      // CRITICAL: Cannot implement owner-only writes. The 'Movie' entity is missing an 'ownerId' or 'authorId' field.
      allow create: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
      allow update: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
      allow delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }
  }
}